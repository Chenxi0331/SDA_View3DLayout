{"ast":null,"code":"/**\r\n * 3D Real Estate Management System - Prototype Pattern Implementation\r\n * Definition of Prototype Interface and Entities\r\n */\n\nimport * as THREE from 'three';\n\n/**\r\n * Interface Component acting as the Prototype\r\n * All entities must implement a clone() method.\r\n */\n\nclass Furniture {\n  constructor(name, type) {\n    this.name = name;\n    this.type = type;\n    // In Three.js, a Mesh is the visual representation\n    this.mesh = new THREE.Mesh();\n    this.mesh.userData = {\n      entityId: this.generateId(),\n      type: 'Furniture',\n      name: name\n    };\n  }\n  generateId() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n  setPosition(x, y, z) {\n    this.mesh.position.set(x, y, z);\n  }\n\n  /**\r\n   * Deep Clone\r\n   * Creates a new Furniture instance and clones the Three.js mesh.\r\n   * The mesh.clone() in Three.js shares geometry/material by default (shallow copy of resources),\r\n   * but creates a new object instance (deep copy of the node).\r\n   */\n  // ... (existing code)\n\n  /**\r\n   * Factory method to create instance from JSON data\r\n   */\n  static fromJSON(data) {\n    const furniture = new Furniture(data.name, data.type);\n    if (data.position) {\n      furniture.setPosition(data.position.x, data.position.y, data.position.z);\n    }\n    // Could also set rotation/scale if needed\n    return furniture;\n  }\n  clone() {\n    const clonedFurniture = new Furniture(this.name, this.type);\n    // Deep copy the visual mesh\n    clonedFurniture.mesh = this.mesh.clone();\n\n    // IMPORTANT: Update unique ID for the session entity vs master\n    clonedFurniture.mesh.userData.entityId = this.generateId();\n    return clonedFurniture;\n  }\n}\nclass Room {\n  constructor(name) {\n    this.name = name;\n    this.furnitureList = [];\n    // A Group holds the structural hierarchy in Three.js\n    this.group = new THREE.Group();\n    this.group.userData = {\n      entityId: this.generateId(),\n      type: 'Room',\n      name: name\n    };\n  }\n  generateId() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n  addFurniture(furniture) {\n    this.furnitureList.push(furniture);\n    this.group.add(furniture.mesh);\n  }\n\n  /**\r\n   * Factory method to create instance from JSON data\r\n   */\n  static fromJSON(data) {\n    const room = new Room(data.name);\n    if (data.furniture) {\n      data.furniture.forEach(itemData => {\n        const furniture = Furniture.fromJSON(itemData);\n        room.addFurniture(furniture);\n      });\n    }\n    return room;\n  }\n\n  /**\r\n   * Deep Clone\r\n   * Iterates through all furniture in the room, cloning them recursively.\r\n   */\n  clone() {\n    const clonedRoom = new Room(this.name);\n\n    // Clone the Three.js Group container (without children first)\n    clonedRoom.group = this.group.clone();\n    // Clear children because standard .clone() might not clone children properly depending on recursive flag,\n    // or we want explicit control over wrapping logic.\n    clonedRoom.group.children = [];\n\n    // Deep clone hierarchy\n    this.furnitureList.forEach(item => {\n      const clonedItem = item.clone(); // Recursive call to Furniture.clone()\n      clonedRoom.addFurniture(clonedItem);\n    });\n\n    // Update ID\n    clonedRoom.group.userData.entityId = this.generateId();\n    return clonedRoom;\n  }\n}\nclass Layout3D {\n  constructor(id, description) {\n    this.id = id;\n    this.description = description;\n    this.rooms = [];\n    this.group = new THREE.Group();\n    this.group.userData = {\n      entityId: id,\n      type: 'Layout3D',\n      isMaster: true\n    };\n  }\n  addRoom(room) {\n    this.rooms.push(room);\n    this.group.add(room.group);\n  }\n\n  /**\r\n   * Factory method to create instance from JSON data\r\n   */\n  static fromJSON(data) {\n    const layout = new Layout3D(data.id, data.name);\n    if (data.rooms) {\n      data.rooms.forEach(roomData => {\n        const room = Room.fromJSON(roomData);\n        layout.addRoom(room);\n      });\n    }\n    return layout;\n  }\n\n  /**\r\n   * Deep Clone\r\n   * This is the entry point for creating a \"Session Entity\".\r\n   */\n  clone() {\n    const clonedLayout = new Layout3D(this.id, this.description); // Keep original ID reference or generate new session ID\n\n    // Clone container\n    clonedLayout.group = this.group.clone();\n    clonedLayout.group.children = [];\n    clonedLayout.group.userData.isMaster = false; // Mark as session instance\n\n    // Deep clone rooms\n    this.rooms.forEach(room => {\n      const clonedRoom = room.clone(); // Recursive call to Room.clone()\n      clonedLayout.addRoom(clonedRoom);\n    });\n    return clonedLayout;\n  }\n}\n\n/**\r\n * Prototype Registry\r\n * Manages Master Entities.\r\n */\nclass LayoutRegistry {\n  constructor() {\n    this.masters = new Map();\n  }\n  registerMaster(id, layout) {\n    console.log(`[Registry] Registering Master Layout: ${id}`);\n    this.masters.set(id, layout);\n  }\n\n  /**\r\n   * getSessionClone\r\n   * Returns a deep-cloned version of the layout.\r\n   * The returned object is a unique \"Session Entity\".\r\n   */\n  getSessionClone(id) {\n    const master = this.masters.get(id);\n    if (!master) {\n      throw new Error(`Layout ${id} not found in registry.`);\n    }\n    console.log(`[Registry] Creating Session Clone for: ${id}`);\n    return master.clone();\n  }\n}\n\n// REMOVED hardcoded createMasterLayout since we load from API now\nexport { Furniture, Room, Layout3D, LayoutRegistry };","map":{"version":3,"names":["THREE","Furniture","constructor","name","type","mesh","Mesh","userData","entityId","generateId","Math","random","toString","substr","setPosition","x","y","z","position","set","fromJSON","data","furniture","clone","clonedFurniture","Room","furnitureList","group","Group","addFurniture","push","add","room","forEach","itemData","clonedRoom","children","item","clonedItem","Layout3D","id","description","rooms","isMaster","addRoom","layout","roomData","clonedLayout","LayoutRegistry","masters","Map","registerMaster","console","log","getSessionClone","master","get","Error"],"sources":["C:/Users/chenx/Documents/sda/prototype/client/src/PrototypePattern.js"],"sourcesContent":["/**\r\n * 3D Real Estate Management System - Prototype Pattern Implementation\r\n * Definition of Prototype Interface and Entities\r\n */\r\n\r\nimport * as THREE from 'three';\r\n\r\n/**\r\n * Interface Component acting as the Prototype\r\n * All entities must implement a clone() method.\r\n */\r\n\r\nclass Furniture {\r\n    constructor(name, type) {\r\n        this.name = name;\r\n        this.type = type;\r\n        // In Three.js, a Mesh is the visual representation\r\n        this.mesh = new THREE.Mesh();\r\n        this.mesh.userData = { entityId: this.generateId(), type: 'Furniture', name: name };\r\n    }\r\n\r\n    generateId() {\r\n        return Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    setPosition(x, y, z) {\r\n        this.mesh.position.set(x, y, z);\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * Creates a new Furniture instance and clones the Three.js mesh.\r\n     * The mesh.clone() in Three.js shares geometry/material by default (shallow copy of resources),\r\n     * but creates a new object instance (deep copy of the node).\r\n     */\r\n    // ... (existing code)\r\n\r\n    /**\r\n     * Factory method to create instance from JSON data\r\n     */\r\n    static fromJSON(data) {\r\n        const furniture = new Furniture(data.name, data.type);\r\n        if (data.position) {\r\n            furniture.setPosition(data.position.x, data.position.y, data.position.z);\r\n        }\r\n        // Could also set rotation/scale if needed\r\n        return furniture;\r\n    }\r\n\r\n    clone() {\r\n        const clonedFurniture = new Furniture(this.name, this.type);\r\n        // Deep copy the visual mesh\r\n        clonedFurniture.mesh = this.mesh.clone();\r\n\r\n        // IMPORTANT: Update unique ID for the session entity vs master\r\n        clonedFurniture.mesh.userData.entityId = this.generateId();\r\n\r\n        return clonedFurniture;\r\n    }\r\n}\r\n\r\nclass Room {\r\n    constructor(name) {\r\n        this.name = name;\r\n        this.furnitureList = [];\r\n        // A Group holds the structural hierarchy in Three.js\r\n        this.group = new THREE.Group();\r\n        this.group.userData = { entityId: this.generateId(), type: 'Room', name: name };\r\n    }\r\n\r\n    generateId() {\r\n        return Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    addFurniture(furniture) {\r\n        this.furnitureList.push(furniture);\r\n        this.group.add(furniture.mesh);\r\n    }\r\n\r\n    /**\r\n     * Factory method to create instance from JSON data\r\n     */\r\n    static fromJSON(data) {\r\n        const room = new Room(data.name);\r\n        if (data.furniture) {\r\n            data.furniture.forEach(itemData => {\r\n                const furniture = Furniture.fromJSON(itemData);\r\n                room.addFurniture(furniture);\r\n            });\r\n        }\r\n        return room;\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * Iterates through all furniture in the room, cloning them recursively.\r\n     */\r\n    clone() {\r\n        const clonedRoom = new Room(this.name);\r\n\r\n        // Clone the Three.js Group container (without children first)\r\n        clonedRoom.group = this.group.clone();\r\n        // Clear children because standard .clone() might not clone children properly depending on recursive flag,\r\n        // or we want explicit control over wrapping logic.\r\n        clonedRoom.group.children = [];\r\n\r\n        // Deep clone hierarchy\r\n        this.furnitureList.forEach(item => {\r\n            const clonedItem = item.clone(); // Recursive call to Furniture.clone()\r\n            clonedRoom.addFurniture(clonedItem);\r\n        });\r\n\r\n        // Update ID\r\n        clonedRoom.group.userData.entityId = this.generateId();\r\n\r\n        return clonedRoom;\r\n    }\r\n}\r\n\r\nclass Layout3D {\r\n    constructor(id, description) {\r\n        this.id = id;\r\n        this.description = description;\r\n        this.rooms = [];\r\n        this.group = new THREE.Group();\r\n        this.group.userData = { entityId: id, type: 'Layout3D', isMaster: true };\r\n    }\r\n\r\n    addRoom(room) {\r\n        this.rooms.push(room);\r\n        this.group.add(room.group);\r\n    }\r\n\r\n    /**\r\n     * Factory method to create instance from JSON data\r\n     */\r\n    static fromJSON(data) {\r\n        const layout = new Layout3D(data.id, data.name);\r\n        if (data.rooms) {\r\n            data.rooms.forEach(roomData => {\r\n                const room = Room.fromJSON(roomData);\r\n                layout.addRoom(room);\r\n            });\r\n        }\r\n        return layout;\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * This is the entry point for creating a \"Session Entity\".\r\n     */\r\n    clone() {\r\n        const clonedLayout = new Layout3D(this.id, this.description); // Keep original ID reference or generate new session ID\r\n\r\n        // Clone container\r\n        clonedLayout.group = this.group.clone();\r\n        clonedLayout.group.children = [];\r\n        clonedLayout.group.userData.isMaster = false; // Mark as session instance\r\n\r\n        // Deep clone rooms\r\n        this.rooms.forEach(room => {\r\n            const clonedRoom = room.clone(); // Recursive call to Room.clone()\r\n            clonedLayout.addRoom(clonedRoom);\r\n        });\r\n\r\n        return clonedLayout;\r\n    }\r\n}\r\n\r\n/**\r\n * Prototype Registry\r\n * Manages Master Entities.\r\n */\r\nclass LayoutRegistry {\r\n    constructor() {\r\n        this.masters = new Map();\r\n    }\r\n\r\n    registerMaster(id, layout) {\r\n        console.log(`[Registry] Registering Master Layout: ${id}`);\r\n        this.masters.set(id, layout);\r\n    }\r\n\r\n    /**\r\n     * getSessionClone\r\n     * Returns a deep-cloned version of the layout.\r\n     * The returned object is a unique \"Session Entity\".\r\n     */\r\n    getSessionClone(id) {\r\n        const master = this.masters.get(id);\r\n        if (!master) {\r\n            throw new Error(`Layout ${id} not found in registry.`);\r\n        }\r\n        console.log(`[Registry] Creating Session Clone for: ${id}`);\r\n        return master.clone();\r\n    }\r\n}\r\n\r\n// REMOVED hardcoded createMasterLayout since we load from API now\r\nexport {\r\n    Furniture,\r\n    Room,\r\n    Layout3D,\r\n    LayoutRegistry\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}