{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\chenx\\\\Documents\\\\sda\\\\prototype\\\\client\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { LayoutRegistry, createMasterLayout } from './PrototypePattern';\nimport ThreeDViewer from './ThreeDViewer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  const [registry] = useState(new LayoutRegistry());\n  const [sessionLayout, setSessionLayout] = useState(null);\n  const [status, setStatus] = useState(\"Initializing...\");\n\n  // Init Master Registry ONCE\n  useEffect(() => {\n    const master = createMasterLayout();\n    registry.registerMaster('layout-001', master);\n    setStatus(\"Master Layout 'layout-001' registered.\");\n  }, [registry]);\n  const handleCreateSession = () => {\n    try {\n      // PROTOTYPE PATTERN: CLONE\n      // We get a fresh deep copy.\n      const newSession = registry.getSessionClone('layout-001');\n      setSessionLayout(newSession);\n      setStatus(\"New Session Created. (Independent Clone)\");\n    } catch (e) {\n      console.error(e);\n      setStatus(\"Error: \" + e.message);\n    }\n  };\n  const handleModifySession = () => {\n    if (!sessionLayout) return;\n\n    // Modify the session entity\n    // Example: Move the first furniture in the first room\n    const room = sessionLayout.rooms[0];\n    if (room && room.furnitureList.length > 0) {\n      const furniture = room.furnitureList[0];\n\n      // Random shift to prove movement\n      const newX = Math.random() * 10 - 5;\n      const newZ = Math.random() * 10 - 5;\n      furniture.setPosition(newX, 0, newZ); // Update internal position\n\n      // Update Mesh reference? \n      // In Three.js, modifying .position directly updates the matrix on next render.\n      // But React needs to know to re-render.\n\n      // Force React update by creating a shallow copy of the container wrapper \n      // (or we can just tell the viewer to update, but easiest is to pass a \"version\" or just clone reference)\n      // Since layoutData is an object, we can just setState with same obj logic if we weren't checking strict equality.\n      // Better:\n      setSessionLayout({\n        ...sessionLayout,\n        _version: Date.now()\n      });\n      setStatus(`Session Modified: Moved ${furniture.name} to (${newX.toFixed(1)}, 0, ${newZ.toFixed(1)})`);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '20px',\n      fontFamily: 'Arial'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Prototype Pattern 3D Viewer\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: '20px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleCreateSession,\n        style: {\n          padding: '10px',\n          marginRight: '10px'\n        },\n        children: \"1. Create New Session Clone\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleModifySession,\n        disabled: !sessionLayout,\n        style: {\n          padding: '10px'\n        },\n        children: \"2. Modify Furniture Position (Session Only)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '10px',\n        background: '#eee',\n        marginBottom: '20px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Status:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 17\n      }, this), \" \", status, \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 51\n      }, this), sessionLayout && /*#__PURE__*/_jsxDEV(\"small\", {\n        children: [\"Session ID: \", sessionLayout.group.userData.entityId, \" (IsMaster: \", String(sessionLayout.group.userData.isMaster), \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ThreeDViewer, {\n      layoutData: sessionLayout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '20px',\n        color: '#666'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Instructions:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Click \\\"Create New Session Clone\\\" to instantiate a deep copy of the Master.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"You should see boxes representing furniture (Red = Sofa).\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Click \\\"Modify Furniture\\\" to move the Red Sofa randomly.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Click \\\"Create New Session Clone\\\" again to revert to the original Master state (proving the Master was never changed).\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 9\n  }, this);\n}\n_s(App, \"Ugbrp/nhWsXVIzEhmiUMrS9C3Mw=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","LayoutRegistry","createMasterLayout","ThreeDViewer","jsxDEV","_jsxDEV","App","_s","registry","sessionLayout","setSessionLayout","status","setStatus","master","registerMaster","handleCreateSession","newSession","getSessionClone","e","console","error","message","handleModifySession","room","rooms","furnitureList","length","furniture","newX","Math","random","newZ","setPosition","_version","Date","now","name","toFixed","style","padding","fontFamily","children","fileName","_jsxFileName","lineNumber","columnNumber","marginBottom","onClick","marginRight","disabled","background","group","userData","entityId","String","isMaster","layoutData","marginTop","color","_c","$RefreshReg$"],"sources":["C:/Users/chenx/Documents/sda/prototype/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { LayoutRegistry, createMasterLayout } from './PrototypePattern';\r\nimport ThreeDViewer from './ThreeDViewer';\r\n\r\nfunction App() {\r\n    const [registry] = useState(new LayoutRegistry());\r\n    const [sessionLayout, setSessionLayout] = useState(null);\r\n    const [status, setStatus] = useState(\"Initializing...\");\r\n\r\n    // Init Master Registry ONCE\r\n    useEffect(() => {\r\n        const master = createMasterLayout();\r\n        registry.registerMaster('layout-001', master);\r\n        setStatus(\"Master Layout 'layout-001' registered.\");\r\n    }, [registry]);\r\n\r\n    const handleCreateSession = () => {\r\n        try {\r\n            // PROTOTYPE PATTERN: CLONE\r\n            // We get a fresh deep copy.\r\n            const newSession = registry.getSessionClone('layout-001');\r\n            setSessionLayout(newSession);\r\n            setStatus(\"New Session Created. (Independent Clone)\");\r\n        } catch (e) {\r\n            console.error(e);\r\n            setStatus(\"Error: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const handleModifySession = () => {\r\n        if (!sessionLayout) return;\r\n\r\n        // Modify the session entity\r\n        // Example: Move the first furniture in the first room\r\n        const room = sessionLayout.rooms[0];\r\n        if (room && room.furnitureList.length > 0) {\r\n            const furniture = room.furnitureList[0];\r\n\r\n            // Random shift to prove movement\r\n            const newX = (Math.random() * 10) - 5;\r\n            const newZ = (Math.random() * 10) - 5;\r\n            furniture.setPosition(newX, 0, newZ); // Update internal position\r\n\r\n            // Update Mesh reference? \r\n            // In Three.js, modifying .position directly updates the matrix on next render.\r\n            // But React needs to know to re-render.\r\n\r\n            // Force React update by creating a shallow copy of the container wrapper \r\n            // (or we can just tell the viewer to update, but easiest is to pass a \"version\" or just clone reference)\r\n            // Since layoutData is an object, we can just setState with same obj logic if we weren't checking strict equality.\r\n            // Better:\r\n            setSessionLayout({ ...sessionLayout, _version: Date.now() });\r\n\r\n            setStatus(`Session Modified: Moved ${furniture.name} to (${newX.toFixed(1)}, 0, ${newZ.toFixed(1)})`);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{ padding: '20px', fontFamily: 'Arial' }}>\r\n            <h1>Prototype Pattern 3D Viewer</h1>\r\n\r\n            <div style={{ marginBottom: '20px' }}>\r\n                <button onClick={handleCreateSession} style={{ padding: '10px', marginRight: '10px' }}>\r\n                    1. Create New Session Clone\r\n                </button>\r\n                <button onClick={handleModifySession} disabled={!sessionLayout} style={{ padding: '10px' }}>\r\n                    2. Modify Furniture Position (Session Only)\r\n                </button>\r\n            </div>\r\n\r\n            <div style={{ padding: '10px', background: '#eee', marginBottom: '20px' }}>\r\n                <strong>Status:</strong> {status} <br />\r\n                {sessionLayout && (\r\n                    <small>Session ID: {sessionLayout.group.userData.entityId} (IsMaster: {String(sessionLayout.group.userData.isMaster)})</small>\r\n                )}\r\n            </div>\r\n\r\n            <ThreeDViewer layoutData={sessionLayout} />\r\n\r\n            <div style={{ marginTop: '20px', color: '#666' }}>\r\n                <p>Instructions:</p>\r\n                <ol>\r\n                    <li>Click \"Create New Session Clone\" to instantiate a deep copy of the Master.</li>\r\n                    <li>You should see boxes representing furniture (Red = Sofa).</li>\r\n                    <li>Click \"Modify Furniture\" to move the Red Sofa randomly.</li>\r\n                    <li>Click \"Create New Session Clone\" again to revert to the original Master state (proving the Master was never changed).</li>\r\n                </ol>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}