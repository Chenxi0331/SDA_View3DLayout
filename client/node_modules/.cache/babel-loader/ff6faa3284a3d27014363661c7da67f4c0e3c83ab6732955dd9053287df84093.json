{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\chenx\\\\Documents\\\\sda\\\\prototype\\\\client\\\\src\\\\ThreeDViewer.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ThreeDViewer = ({\n  layoutData\n}) => {\n  _s();\n  const mountRef = useRef(null);\n  const sceneRef = useRef(null);\n  const rendererRef = useRef(null);\n  const controlsRef = useRef(null);\n  useEffect(() => {\n    // --- Init Scene ---\n    const width = mountRef.current.clientWidth;\n    const height = mountRef.current.clientHeight;\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0xf0f0f0); // Soft grey background\n    // scene.fog = new THREE.Fog(0xf0f0f0, 20, 100); \n    sceneRef.current = scene;\n    const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);\n    camera.position.set(0, 20, 30);\n    camera.lookAt(0, 0, 0);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(width, height);\n    renderer.shadowMap.enabled = true; // Enable Shadows\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n    renderer.outputColorSpace = THREE.SRGBColorSpace; // Correct colors\n    mountRef.current.appendChild(renderer.domElement);\n    rendererRef.current = renderer;\n\n    // --- Controls ---\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controlsRef.current = controls;\n\n    // --- Environment ---\n    // Floor\n    const floorGeometry = new THREE.PlaneGeometry(100, 100);\n    const floorMaterial = new THREE.MeshStandardMaterial({\n      color: 0xeeeeee,\n      roughness: 0.8,\n      metalness: 0.2\n    });\n    const floor = new THREE.Mesh(floorGeometry, floorMaterial);\n    floor.rotation.x = -Math.PI / 2;\n    floor.receiveShadow = true;\n    scene.add(floor);\n    const gridHelper = new THREE.GridHelper(100, 50, 0xcccccc, 0xeeeeee);\n    scene.add(gridHelper);\n\n    // --- Lighting ---\n    const ambientLight = new THREE.AmbientLight(0xffffff, 1.5); // Soft white light\n    scene.add(ambientLight);\n    const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);\n    hemiLight.position.set(0, 20, 0);\n    scene.add(hemiLight);\n    const dirLight = new THREE.DirectionalLight(0xffffff, 3);\n    dirLight.position.set(10, 20, 10);\n    dirLight.castShadow = true;\n    dirLight.shadow.mapSize.width = 2048;\n    dirLight.shadow.mapSize.height = 2048;\n    dirLight.shadow.camera.near = 0.5;\n    dirLight.shadow.camera.far = 50;\n    dirLight.shadow.camera.left = -25;\n    dirLight.shadow.camera.right = 25;\n    dirLight.shadow.camera.top = 25;\n    dirLight.shadow.camera.bottom = -25;\n    scene.add(dirLight);\n\n    // --- Animation Loop ---\n    const animate = () => {\n      requestAnimationFrame(animate);\n      controls.update();\n      renderer.render(scene, camera);\n    };\n    animate();\n    return () => {\n      if (mountRef.current && renderer.domElement) {\n        mountRef.current.removeChild(renderer.domElement);\n      }\n      renderer.dispose();\n      controls.dispose();\n    };\n  }, []);\n\n  // --- Update Layout ---\n  useEffect(() => {\n    if (!layoutData || !sceneRef.current) return;\n\n    // Clear previous generic meshes (keep lights/helpers/floor)\n    const scene = sceneRef.current;\n\n    // Remove old layout groups (detect by userData.entityId)\n    for (let i = scene.children.length - 1; i >= 0; i--) {\n      const child = scene.children[i];\n      // We only remove the objects that are part of our data structure\n      if (child.userData.entityId) {\n        scene.remove(child);\n      }\n    }\n\n    // Add New Layout\n    const rootGroup = layoutData.group;\n    scene.add(rootGroup);\n    console.log(\"Adding layout to scene:\", layoutData);\n\n    // --- Initial Transform for loaded models ---\n    // Some models might be huge or tiny, typically we don't auto-scale here \n    // because we want real dimensions, but for this demo check:\n    // (We rely on the data in layout.json to set scale)\n  }, [layoutData]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mountRef,\n    style: {\n      width: '100%',\n      height: '600px',\n      border: '1px solid #ccc',\n      borderRadius: '8px',\n      overflow: 'hidden'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 12\n  }, this);\n};\n_s(ThreeDViewer, \"gNQSLE6j3y2KY/R6Eea4wBpewjI=\");\n_c = ThreeDViewer;\nexport default ThreeDViewer;\nvar _c;\n$RefreshReg$(_c, \"ThreeDViewer\");","map":{"version":3,"names":["React","useEffect","useRef","THREE","OrbitControls","jsxDEV","_jsxDEV","ThreeDViewer","layoutData","_s","mountRef","sceneRef","rendererRef","controlsRef","width","current","clientWidth","height","clientHeight","scene","Scene","background","Color","camera","PerspectiveCamera","position","set","lookAt","renderer","WebGLRenderer","antialias","setSize","shadowMap","enabled","type","PCFSoftShadowMap","outputColorSpace","SRGBColorSpace","appendChild","domElement","controls","enableDamping","dampingFactor","floorGeometry","PlaneGeometry","floorMaterial","MeshStandardMaterial","color","roughness","metalness","floor","Mesh","rotation","x","Math","PI","receiveShadow","add","gridHelper","GridHelper","ambientLight","AmbientLight","hemiLight","HemisphereLight","dirLight","DirectionalLight","castShadow","shadow","mapSize","near","far","left","right","top","bottom","animate","requestAnimationFrame","update","render","removeChild","dispose","i","children","length","child","userData","entityId","remove","rootGroup","group","console","log","ref","style","border","borderRadius","overflow","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/chenx/Documents/sda/prototype/client/src/ThreeDViewer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\n\r\nconst ThreeDViewer = ({ layoutData }) => {\r\n    const mountRef = useRef(null);\r\n    const sceneRef = useRef(null);\r\n    const rendererRef = useRef(null);\r\n    const controlsRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        // --- Init Scene ---\r\n        const width = mountRef.current.clientWidth;\r\n        const height = mountRef.current.clientHeight;\r\n\r\n        const scene = new THREE.Scene();\r\n        scene.background = new THREE.Color(0xf0f0f0); // Soft grey background\r\n        // scene.fog = new THREE.Fog(0xf0f0f0, 20, 100); \r\n        sceneRef.current = scene;\r\n\r\n        const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);\r\n        camera.position.set(0, 20, 30);\r\n        camera.lookAt(0, 0, 0);\r\n\r\n        const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n        renderer.setSize(width, height);\r\n        renderer.shadowMap.enabled = true; // Enable Shadows\r\n        renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        renderer.outputColorSpace = THREE.SRGBColorSpace; // Correct colors\r\n        mountRef.current.appendChild(renderer.domElement);\r\n        rendererRef.current = renderer;\r\n\r\n        // --- Controls ---\r\n        const controls = new OrbitControls(camera, renderer.domElement);\r\n        controls.enableDamping = true;\r\n        controls.dampingFactor = 0.05;\r\n        controlsRef.current = controls;\r\n\r\n        // --- Environment ---\r\n        // Floor\r\n        const floorGeometry = new THREE.PlaneGeometry(100, 100);\r\n        const floorMaterial = new THREE.MeshStandardMaterial({\r\n            color: 0xeeeeee,\r\n            roughness: 0.8,\r\n            metalness: 0.2\r\n        });\r\n        const floor = new THREE.Mesh(floorGeometry, floorMaterial);\r\n        floor.rotation.x = -Math.PI / 2;\r\n        floor.receiveShadow = true;\r\n        scene.add(floor);\r\n\r\n        const gridHelper = new THREE.GridHelper(100, 50, 0xcccccc, 0xeeeeee);\r\n        scene.add(gridHelper);\r\n\r\n        // --- Lighting ---\r\n        const ambientLight = new THREE.AmbientLight(0xffffff, 1.5); // Soft white light\r\n        scene.add(ambientLight);\r\n\r\n        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);\r\n        hemiLight.position.set(0, 20, 0);\r\n        scene.add(hemiLight);\r\n\r\n        const dirLight = new THREE.DirectionalLight(0xffffff, 3);\r\n        dirLight.position.set(10, 20, 10);\r\n        dirLight.castShadow = true;\r\n        dirLight.shadow.mapSize.width = 2048;\r\n        dirLight.shadow.mapSize.height = 2048;\r\n        dirLight.shadow.camera.near = 0.5;\r\n        dirLight.shadow.camera.far = 50;\r\n        dirLight.shadow.camera.left = -25;\r\n        dirLight.shadow.camera.right = 25;\r\n        dirLight.shadow.camera.top = 25;\r\n        dirLight.shadow.camera.bottom = -25;\r\n        scene.add(dirLight);\r\n\r\n        // --- Animation Loop ---\r\n        const animate = () => {\r\n            requestAnimationFrame(animate);\r\n            controls.update();\r\n            renderer.render(scene, camera);\r\n        };\r\n        animate();\r\n\r\n        return () => {\r\n            if (mountRef.current && renderer.domElement) {\r\n                mountRef.current.removeChild(renderer.domElement);\r\n            }\r\n            renderer.dispose();\r\n            controls.dispose();\r\n        };\r\n    }, []);\r\n\r\n    // --- Update Layout ---\r\n    useEffect(() => {\r\n        if (!layoutData || !sceneRef.current) return;\r\n\r\n        // Clear previous generic meshes (keep lights/helpers/floor)\r\n        const scene = sceneRef.current;\r\n\r\n        // Remove old layout groups (detect by userData.entityId)\r\n        for (let i = scene.children.length - 1; i >= 0; i--) {\r\n            const child = scene.children[i];\r\n            // We only remove the objects that are part of our data structure\r\n            if (child.userData.entityId) {\r\n                scene.remove(child);\r\n            }\r\n        }\r\n\r\n        // Add New Layout\r\n        const rootGroup = layoutData.group;\r\n        scene.add(rootGroup);\r\n\r\n        console.log(\"Adding layout to scene:\", layoutData);\r\n\r\n        // --- Initial Transform for loaded models ---\r\n        // Some models might be huge or tiny, typically we don't auto-scale here \r\n        // because we want real dimensions, but for this demo check:\r\n        // (We rely on the data in layout.json to set scale)\r\n\r\n    }, [layoutData]);\r\n\r\n    return <div ref={mountRef} style={{ width: '100%', height: '600px', border: '1px solid #ccc', borderRadius: '8px', overflow: 'hidden' }} />;\r\n};\r\n\r\nexport default ThreeDViewer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}