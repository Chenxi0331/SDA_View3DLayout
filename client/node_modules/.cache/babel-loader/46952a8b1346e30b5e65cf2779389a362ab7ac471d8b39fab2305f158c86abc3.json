{"ast":null,"code":"/**\r\n * 3D Real Estate Management System - Prototype Pattern Implementation\r\n * Definition of Prototype Interface and Entities\r\n */\n\n// Access THREE from global scope (set in index.js)\nconst THREE = window.THREE;\n\n/**\r\n * Interface Component acting as the Prototype\r\n * All entities must implement a clone() method.\r\n */\n\nclass Furniture {\n  constructor(name, type) {\n    this.name = name;\n    this.type = type;\n    // In Three.js, a Mesh is the visual representation\n    this.mesh = new THREE.Mesh();\n    this.mesh.userData = {\n      entityId: this.generateId(),\n      type: 'Furniture',\n      name: name\n    };\n  }\n  generateId() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n  setPosition(x, y, z) {\n    this.mesh.position.set(x, y, z);\n  }\n\n  /**\r\n   * Deep Clone\r\n   * Creates a new Furniture instance and clones the Three.js mesh.\r\n   * The mesh.clone() in Three.js shares geometry/material by default (shallow copy of resources),\r\n   * but creates a new object instance (deep copy of the node).\r\n   */\n  clone() {\n    const clonedFurniture = new Furniture(this.name, this.type);\n    // Deep copy the visual mesh\n    clonedFurniture.mesh = this.mesh.clone();\n\n    // IMPORTANT: Update unique ID for the session entity vs master\n    clonedFurniture.mesh.userData.entityId = this.generateId();\n    return clonedFurniture;\n  }\n}\nclass Room {\n  constructor(name) {\n    this.name = name;\n    this.furnitureList = [];\n    // A Group holds the structural hierarchy in Three.js\n    this.group = new THREE.Group();\n    this.group.userData = {\n      entityId: this.generateId(),\n      type: 'Room',\n      name: name\n    };\n  }\n  generateId() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n  addFurniture(furniture) {\n    this.furnitureList.push(furniture);\n    this.group.add(furniture.mesh);\n  }\n\n  /**\r\n   * Deep Clone\r\n   * Iterates through all furniture in the room, cloning them recursively.\r\n   */\n  clone() {\n    const clonedRoom = new Room(this.name);\n\n    // Clone the Three.js Group container (without children first)\n    clonedRoom.group = this.group.clone();\n    // Clear children because standard .clone() might not clone children properly depending on recursive flag,\n    // or we want explicit control over wrapping logic.\n    clonedRoom.group.children = [];\n\n    // Deep clone hierarchy\n    this.furnitureList.forEach(item => {\n      const clonedItem = item.clone(); // Recursive call to Furniture.clone()\n      clonedRoom.addFurniture(clonedItem);\n    });\n\n    // Update ID\n    clonedRoom.group.userData.entityId = this.generateId();\n    return clonedRoom;\n  }\n}\nclass Layout3D {\n  constructor(id, description) {\n    this.id = id;\n    this.description = description;\n    this.rooms = [];\n    this.group = new THREE.Group();\n    this.group.userData = {\n      entityId: id,\n      type: 'Layout3D',\n      isMaster: true\n    };\n  }\n  addRoom(room) {\n    this.rooms.push(room);\n    this.group.add(room.group);\n  }\n\n  /**\r\n   * Deep Clone\r\n   * This is the entry point for creating a \"Session Entity\".\r\n   */\n  clone() {\n    const clonedLayout = new Layout3D(this.id, this.description); // Keep original ID reference or generate new session ID\n\n    // Clone container\n    clonedLayout.group = this.group.clone();\n    clonedLayout.group.children = [];\n    clonedLayout.group.userData.isMaster = false; // Mark as session instance\n\n    // Deep clone rooms\n    this.rooms.forEach(room => {\n      const clonedRoom = room.clone(); // Recursive call to Room.clone()\n      clonedLayout.addRoom(clonedRoom);\n    });\n    return clonedLayout;\n  }\n}\n\n/**\r\n * Prototype Registry\r\n * Manages Master Entities.\r\n */\nclass LayoutRegistry {\n  constructor() {\n    this.masters = new Map();\n  }\n  registerMaster(id, layout) {\n    console.log(`[Registry] Registering Master Layout: ${id}`);\n    this.masters.set(id, layout);\n  }\n\n  /**\r\n   * getSessionClone\r\n   * Returns a deep-cloned version of the layout.\r\n   * The returned object is a unique \"Session Entity\".\r\n   */\n  getSessionClone(id) {\n    const master = this.masters.get(id);\n    if (!master) {\n      throw new Error(`Layout ${id} not found in registry.`);\n    }\n    console.log(`[Registry] Creating Session Clone for: ${id}`);\n    return master.clone();\n  }\n}\n\n// Helper to create a sample master\nfunction createMasterLayout() {\n  const masterLayout = new Layout3D('layout-001', 'Standard 1BHK');\n\n  // Room 1: Living Room\n  const livingRoom = new Room('Living Room');\n  const sofa = new Furniture('Sofa', 'Seating');\n  sofa.setPosition(0, 0, 0); // Center\n  const tv = new Furniture('TV Stand', 'Electronics');\n  tv.setPosition(5, 0, 0);\n  livingRoom.addFurniture(sofa);\n  livingRoom.addFurniture(tv);\n  masterLayout.addRoom(livingRoom);\n  return masterLayout;\n}\nexport { Furniture, Room, Layout3D, LayoutRegistry, createMasterLayout };","map":{"version":3,"names":["THREE","window","Furniture","constructor","name","type","mesh","Mesh","userData","entityId","generateId","Math","random","toString","substr","setPosition","x","y","z","position","set","clone","clonedFurniture","Room","furnitureList","group","Group","addFurniture","furniture","push","add","clonedRoom","children","forEach","item","clonedItem","Layout3D","id","description","rooms","isMaster","addRoom","room","clonedLayout","LayoutRegistry","masters","Map","registerMaster","layout","console","log","getSessionClone","master","get","Error","createMasterLayout","masterLayout","livingRoom","sofa","tv"],"sources":["C:/Users/chenx/Documents/sda/prototype/client/src/PrototypePattern.js"],"sourcesContent":["/**\r\n * 3D Real Estate Management System - Prototype Pattern Implementation\r\n * Definition of Prototype Interface and Entities\r\n */\r\n\r\n// Access THREE from global scope (set in index.js)\r\nconst THREE = window.THREE;\r\n\r\n/**\r\n * Interface Component acting as the Prototype\r\n * All entities must implement a clone() method.\r\n */\r\n\r\nclass Furniture {\r\n    constructor(name, type) {\r\n        this.name = name;\r\n        this.type = type;\r\n        // In Three.js, a Mesh is the visual representation\r\n        this.mesh = new THREE.Mesh();\r\n        this.mesh.userData = { entityId: this.generateId(), type: 'Furniture', name: name };\r\n    }\r\n\r\n    generateId() {\r\n        return Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    setPosition(x, y, z) {\r\n        this.mesh.position.set(x, y, z);\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * Creates a new Furniture instance and clones the Three.js mesh.\r\n     * The mesh.clone() in Three.js shares geometry/material by default (shallow copy of resources),\r\n     * but creates a new object instance (deep copy of the node).\r\n     */\r\n    clone() {\r\n        const clonedFurniture = new Furniture(this.name, this.type);\r\n        // Deep copy the visual mesh\r\n        clonedFurniture.mesh = this.mesh.clone();\r\n\r\n        // IMPORTANT: Update unique ID for the session entity vs master\r\n        clonedFurniture.mesh.userData.entityId = this.generateId();\r\n\r\n        return clonedFurniture;\r\n    }\r\n}\r\n\r\nclass Room {\r\n    constructor(name) {\r\n        this.name = name;\r\n        this.furnitureList = [];\r\n        // A Group holds the structural hierarchy in Three.js\r\n        this.group = new THREE.Group();\r\n        this.group.userData = { entityId: this.generateId(), type: 'Room', name: name };\r\n    }\r\n\r\n    generateId() {\r\n        return Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    addFurniture(furniture) {\r\n        this.furnitureList.push(furniture);\r\n        this.group.add(furniture.mesh);\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * Iterates through all furniture in the room, cloning them recursively.\r\n     */\r\n    clone() {\r\n        const clonedRoom = new Room(this.name);\r\n\r\n        // Clone the Three.js Group container (without children first)\r\n        clonedRoom.group = this.group.clone();\r\n        // Clear children because standard .clone() might not clone children properly depending on recursive flag,\r\n        // or we want explicit control over wrapping logic.\r\n        clonedRoom.group.children = [];\r\n\r\n        // Deep clone hierarchy\r\n        this.furnitureList.forEach(item => {\r\n            const clonedItem = item.clone(); // Recursive call to Furniture.clone()\r\n            clonedRoom.addFurniture(clonedItem);\r\n        });\r\n\r\n        // Update ID\r\n        clonedRoom.group.userData.entityId = this.generateId();\r\n\r\n        return clonedRoom;\r\n    }\r\n}\r\n\r\nclass Layout3D {\r\n    constructor(id, description) {\r\n        this.id = id;\r\n        this.description = description;\r\n        this.rooms = [];\r\n        this.group = new THREE.Group();\r\n        this.group.userData = { entityId: id, type: 'Layout3D', isMaster: true };\r\n    }\r\n\r\n    addRoom(room) {\r\n        this.rooms.push(room);\r\n        this.group.add(room.group);\r\n    }\r\n\r\n    /**\r\n     * Deep Clone\r\n     * This is the entry point for creating a \"Session Entity\".\r\n     */\r\n    clone() {\r\n        const clonedLayout = new Layout3D(this.id, this.description); // Keep original ID reference or generate new session ID\r\n\r\n        // Clone container\r\n        clonedLayout.group = this.group.clone();\r\n        clonedLayout.group.children = [];\r\n        clonedLayout.group.userData.isMaster = false; // Mark as session instance\r\n\r\n        // Deep clone rooms\r\n        this.rooms.forEach(room => {\r\n            const clonedRoom = room.clone(); // Recursive call to Room.clone()\r\n            clonedLayout.addRoom(clonedRoom);\r\n        });\r\n\r\n        return clonedLayout;\r\n    }\r\n}\r\n\r\n/**\r\n * Prototype Registry\r\n * Manages Master Entities.\r\n */\r\nclass LayoutRegistry {\r\n    constructor() {\r\n        this.masters = new Map();\r\n    }\r\n\r\n    registerMaster(id, layout) {\r\n        console.log(`[Registry] Registering Master Layout: ${id}`);\r\n        this.masters.set(id, layout);\r\n    }\r\n\r\n    /**\r\n     * getSessionClone\r\n     * Returns a deep-cloned version of the layout.\r\n     * The returned object is a unique \"Session Entity\".\r\n     */\r\n    getSessionClone(id) {\r\n        const master = this.masters.get(id);\r\n        if (!master) {\r\n            throw new Error(`Layout ${id} not found in registry.`);\r\n        }\r\n        console.log(`[Registry] Creating Session Clone for: ${id}`);\r\n        return master.clone();\r\n    }\r\n}\r\n\r\n// Helper to create a sample master\r\nfunction createMasterLayout() {\r\n    const masterLayout = new Layout3D('layout-001', 'Standard 1BHK');\r\n\r\n    // Room 1: Living Room\r\n    const livingRoom = new Room('Living Room');\r\n    const sofa = new Furniture('Sofa', 'Seating');\r\n    sofa.setPosition(0, 0, 0); // Center\r\n    const tv = new Furniture('TV Stand', 'Electronics');\r\n    tv.setPosition(5, 0, 0);\r\n\r\n    livingRoom.addFurniture(sofa);\r\n    livingRoom.addFurniture(tv);\r\n\r\n    masterLayout.addRoom(livingRoom);\r\n\r\n    return masterLayout;\r\n}\r\n\r\nexport {\r\n    Furniture,\r\n    Room,\r\n    Layout3D,\r\n    LayoutRegistry,\r\n    createMasterLayout\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}