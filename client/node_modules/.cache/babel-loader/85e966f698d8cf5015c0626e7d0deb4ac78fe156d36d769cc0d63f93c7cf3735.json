{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\chenx\\\\Documents\\\\sda\\\\prototype\\\\client\\\\src\\\\ThreeDViewer.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport * as THREE from 'three';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ThreeDViewer = ({\n  layoutData\n}) => {\n  _s();\n  const mountRef = useRef(null);\n  const sceneRef = useRef(null);\n  const rendererRef = useRef(null);\n  useEffect(() => {\n    // --- Init Scene ---\n    const width = mountRef.current.clientWidth;\n    const height = mountRef.current.clientHeight;\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0xf0f0f0);\n    sceneRef.current = scene;\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\n    camera.position.z = 20;\n    camera.position.y = 10;\n    camera.lookAt(0, 0, 0);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(width, height);\n    mountRef.current.appendChild(renderer.domElement);\n    rendererRef.current = renderer;\n\n    // --- Lights ---\n    const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft white light\n    scene.add(ambientLight);\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);\n    directionalLight.position.set(10, 20, 10);\n    scene.add(directionalLight);\n\n    // --- Grid Helper ---\n    const gridHelper = new THREE.GridHelper(50, 50);\n    scene.add(gridHelper);\n\n    // --- Animation Loop ---\n    const animate = () => {\n      requestAnimationFrame(animate);\n      renderer.render(scene, camera);\n    };\n    animate();\n    return () => {\n      if (mountRef.current && renderer.domElement) {\n        mountRef.current.removeChild(renderer.domElement);\n      }\n      renderer.dispose();\n    };\n  }, []);\n\n  // --- Update Layout ---\n  useEffect(() => {\n    if (!layoutData || !sceneRef.current) return;\n\n    // Clear previous generic meshes (keep lights/helpers if tagged, or just clear non-lights)\n    // Simplest: remove everything that is a group or mesh that is not our helpers\n    // actually, let's just trace the logic: remove the old layout group if we saved it.\n    // But for specific prop updates:\n    const scene = sceneRef.current;\n\n    // Remove old layout groups\n    for (let i = scene.children.length - 1; i >= 0; i--) {\n      const child = scene.children[i];\n      if ((child.type === 'Group' || child.type === 'Mesh') && child.userData.entityId) {\n        scene.remove(child);\n      }\n    }\n\n    // Add New Layout\n    const rootGroup = layoutData.group;\n    scene.add(rootGroup);\n    console.log(\"Adding layout to scene:\", layoutData);\n\n    // --- VISUALIZATION ENHANCEMENT ---\n    // The prototype objects have empty meshes. We need to give them geometry to be seen.\n    rootGroup.traverse(object => {\n      if (object.isMesh && object.userData.type === 'Furniture') {\n        // Assign geometry if missing\n        if (!object.geometry || object.geometry.type === 'BufferGeometry') {\n          // Default empty\n          object.geometry = new THREE.BoxGeometry(2, 2, 2);\n\n          // Different colors for diferent furniture?\n          const color = object.userData.name.includes('Sofa') ? 0xff0000 : 0x00ff00;\n          object.material = new THREE.MeshStandardMaterial({\n            color: color\n          });\n        }\n      }\n    });\n  }, [layoutData]); // Re-run when layoutData changes (new session or same session obj reference updated?) \n  // Note: Mutating the session object's position won't trigger this Effect unless the reference changes.\n  // In React, we usually forceUpdate or clone. But for this demo, we can just rely on standard re-renders if parent passes new prop or we use a ref.\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mountRef,\n    style: {\n      width: '100%',\n      height: '600px',\n      border: '1px solid #ccc'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 12\n  }, this);\n};\n_s(ThreeDViewer, \"SJNr+tL7lz8JBUdvDy8CY+2mntg=\");\n_c = ThreeDViewer;\nexport default ThreeDViewer;\nvar _c;\n$RefreshReg$(_c, \"ThreeDViewer\");","map":{"version":3,"names":["React","useEffect","useRef","THREE","jsxDEV","_jsxDEV","ThreeDViewer","layoutData","_s","mountRef","sceneRef","rendererRef","width","current","clientWidth","height","clientHeight","scene","Scene","background","Color","camera","PerspectiveCamera","position","z","y","lookAt","renderer","WebGLRenderer","antialias","setSize","appendChild","domElement","ambientLight","AmbientLight","add","directionalLight","DirectionalLight","set","gridHelper","GridHelper","animate","requestAnimationFrame","render","removeChild","dispose","i","children","length","child","type","userData","entityId","remove","rootGroup","group","console","log","traverse","object","isMesh","geometry","BoxGeometry","color","name","includes","material","MeshStandardMaterial","ref","style","border","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/chenx/Documents/sda/prototype/client/src/ThreeDViewer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\n\r\nconst ThreeDViewer = ({ layoutData }) => {\r\n    const mountRef = useRef(null);\r\n    const sceneRef = useRef(null);\r\n    const rendererRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        // --- Init Scene ---\r\n        const width = mountRef.current.clientWidth;\r\n        const height = mountRef.current.clientHeight;\r\n\r\n        const scene = new THREE.Scene();\r\n        scene.background = new THREE.Color(0xf0f0f0);\r\n        sceneRef.current = scene;\r\n\r\n        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\r\n        camera.position.z = 20;\r\n        camera.position.y = 10;\r\n        camera.lookAt(0, 0, 0);\r\n\r\n        const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n        renderer.setSize(width, height);\r\n        mountRef.current.appendChild(renderer.domElement);\r\n        rendererRef.current = renderer;\r\n\r\n        // --- Lights ---\r\n        const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft white light\r\n        scene.add(ambientLight);\r\n        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);\r\n        directionalLight.position.set(10, 20, 10);\r\n        scene.add(directionalLight);\r\n\r\n        // --- Grid Helper ---\r\n        const gridHelper = new THREE.GridHelper(50, 50);\r\n        scene.add(gridHelper);\r\n\r\n        // --- Animation Loop ---\r\n        const animate = () => {\r\n            requestAnimationFrame(animate);\r\n            renderer.render(scene, camera);\r\n        };\r\n        animate();\r\n\r\n        return () => {\r\n            if (mountRef.current && renderer.domElement) {\r\n                mountRef.current.removeChild(renderer.domElement);\r\n            }\r\n            renderer.dispose();\r\n        };\r\n    }, []);\r\n\r\n    // --- Update Layout ---\r\n    useEffect(() => {\r\n        if (!layoutData || !sceneRef.current) return;\r\n\r\n        // Clear previous generic meshes (keep lights/helpers if tagged, or just clear non-lights)\r\n        // Simplest: remove everything that is a group or mesh that is not our helpers\r\n        // actually, let's just trace the logic: remove the old layout group if we saved it.\r\n        // But for specific prop updates:\r\n        const scene = sceneRef.current;\r\n\r\n        // Remove old layout groups\r\n        for (let i = scene.children.length - 1; i >= 0; i--) {\r\n            const child = scene.children[i];\r\n            if ((child.type === 'Group' || child.type === 'Mesh') && child.userData.entityId) {\r\n                scene.remove(child);\r\n            }\r\n        }\r\n\r\n        // Add New Layout\r\n        const rootGroup = layoutData.group;\r\n        scene.add(rootGroup);\r\n\r\n        console.log(\"Adding layout to scene:\", layoutData);\r\n\r\n        // --- VISUALIZATION ENHANCEMENT ---\r\n        // The prototype objects have empty meshes. We need to give them geometry to be seen.\r\n        rootGroup.traverse((object) => {\r\n            if (object.isMesh && object.userData.type === 'Furniture') {\r\n                // Assign geometry if missing\r\n                if (!object.geometry || object.geometry.type === 'BufferGeometry') { // Default empty\r\n                    object.geometry = new THREE.BoxGeometry(2, 2, 2);\r\n\r\n                    // Different colors for diferent furniture?\r\n                    const color = object.userData.name.includes('Sofa') ? 0xff0000 : 0x00ff00;\r\n                    object.material = new THREE.MeshStandardMaterial({ color: color });\r\n                }\r\n            }\r\n        });\r\n\r\n    }, [layoutData]); // Re-run when layoutData changes (new session or same session obj reference updated?) \r\n    // Note: Mutating the session object's position won't trigger this Effect unless the reference changes.\r\n    // In React, we usually forceUpdate or clone. But for this demo, we can just rely on standard re-renders if parent passes new prop or we use a ref.\r\n\r\n    return <div ref={mountRef} style={{ width: '100%', height: '600px', border: '1px solid #ccc' }} />;\r\n};\r\n\r\nexport default ThreeDViewer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}